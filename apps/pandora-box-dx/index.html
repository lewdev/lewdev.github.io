<!doctype html>
<head>
  <title>Pandora Box DX - Game List</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0-beta1/css/bootstrap.min.css" integrity="sha512-o/MhoRPVLExxZjCFVBsm17Pkztkzmh7Dp8k7/3JrtNCHh0AQ489kwpfA3dPSHzKDe8YCuEhxXq3Y71eb/o6amg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ®</text></svg>">
</head>
<body>
  <div class="container mt-3">
    <h1>ğŸ•¹ï¸ Pandora Box DX - Game List</h1>
    <p id=controls></p>
    <div class="justify-content-between d-flex">
      <input id="searchInput" type="text" onkeyup="render()" class="form-control" placeholder="Search...">
      <label class="text-nowrap mx-2"><input id="is3dInput" type="checkbox" onchange="render()"> 3D</label>
    </div>
    <p id=o></p>
  </div>
<script src="pandora-box-dx-games.js"></script>
<script>
const cap = s => s.charAt(0).toUpperCase() + s.substring(1);

const controls = document.getElementById("controls");
const o = document.getElementById("o");

const FILTERS = "category, players, system".split(", ");
const COLUMNS = "id, title, category, players, system, is3D".split(", ");

// data.value = list.map(a => COLUMNS.map(attr => a[attr] ? `"${a[attr]}"` : "").join`,`).join`\n`;

const renderBtnGroup = (arr, attr) => `<div>
  ${arr.map(a => {
    const selected = filterMap[attr] === a;
    const classVal = `class="btn btn-${selected ? "primary" : "secondary"} m-1"`;
    return `<button ${classVal} onclick="selectFilter('${attr}', '${a}')">${a}</button>`;
  }).join``}
</div>`;

let searchStr = "";
const filterMap = {};
let filteredList = list;

const render = () => {
  const search = searchInput.value;
  const is3d = is3dInput.checked;
  filteredList = list.filter(row => {
    const filterMapCount = Object.keys(filterMap).length;
    return (
      (!search || row.title.toLowerCase().includes(search.toLowerCase()))
      && (filterMapCount === 0 || FILTERS.filter(a => filterMap[a] && row[a] === filterMap[a]).length === filterMapCount)
      && (is3d ? row.is3D : true)
    );
  });
  const filterListMap = FILTERS.reduce((map, attr) => {
    map[attr] = Array.from(new Set(filteredList.map(a => a[attr]))).filter(a => a);
    return map;
  }, {});
  controls.innerHTML = Object.keys(filterListMap).map(attr => renderBtnGroup(filterListMap[attr], attr)).join``;
  o.innerHTML = `<div>Count: ${filteredList.length}</div><table class="table">
<thead><tr>${COLUMNS.map(a => `<th>${cap(a)}</th>`).join``}</tr></thead>
<tbody>
  ${filteredList.map(row => {
    return `<tr>${COLUMNS.map(a => `<td${a !== "title" ? " align='center'" : ''}>${row[a] || "-"}</td>`).join``}</tr>`;
  }).join``}
</tbody></table>`;
}

const selectFilter = (attr, val) => {
  filterMap[attr] = filterMap[attr] === val ? "" : val;
  if (!filterMap[attr]) delete filterMap[attr];
  render();
};


onload = () => {
  render();
};
</script>
</body>