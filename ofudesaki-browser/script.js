function h(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function n(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:h(a)}}var u="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
function ba(a,b){if(b){var c=u;a=a.split(".");for(var e=0;e<a.length-1;e++){var f=a[e];f in c||(c[f]={});c=c[f]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}}
ba("Promise",function(a){function b(d){this.b=0;this.g=void 0;this.a=[];var g=this.c();try{d(g.resolve,g.reject)}catch(k){g.reject(k)}}function c(){this.a=null}function e(d){return d instanceof b?d:new b(function(g){g(d)})}if(a)return a;c.prototype.b=function(d){if(null==this.a){this.a=[];var g=this;this.c(function(){g.g()})}this.a.push(d)};var f=u.setTimeout;c.prototype.c=function(d){f(d,0)};c.prototype.g=function(){for(;this.a&&this.a.length;){var d=this.a;this.a=[];for(var g=0;g<d.length;++g){var k=
d[g];d[g]=null;try{k()}catch(m){this.f(m)}}}this.a=null};c.prototype.f=function(d){this.c(function(){throw d;})};b.prototype.c=function(){function d(m){return function(p){k||(k=!0,m.call(g,p))}}var g=this,k=!1;return{resolve:d(this.s),reject:d(this.f)}};b.prototype.s=function(d){if(d===this)this.f(new TypeError("A Promise cannot resolve to itself"));else if(d instanceof b)this.u(d);else{a:switch(typeof d){case "object":var g=null!=d;break a;case "function":g=!0;break a;default:g=!1}g?this.o(d):this.j(d)}};
b.prototype.o=function(d){var g=void 0;try{g=d.then}catch(k){this.f(k);return}"function"==typeof g?this.v(g,d):this.j(d)};b.prototype.f=function(d){this.l(2,d)};b.prototype.j=function(d){this.l(1,d)};b.prototype.l=function(d,g){if(0!=this.b)throw Error("Cannot settle("+d+", "+g+"): Promise already settled in state"+this.b);this.b=d;this.g=g;this.m()};b.prototype.m=function(){if(null!=this.a){for(var d=0;d<this.a.length;++d)l.b(this.a[d]);this.a=null}};var l=new c;b.prototype.u=function(d){var g=this.c();
d.i(g.resolve,g.reject)};b.prototype.v=function(d,g){var k=this.c();try{d.call(g,k.resolve,k.reject)}catch(m){k.reject(m)}};b.prototype.then=function(d,g){function k(q,r){return"function"==typeof q?function(H){try{m(q(H))}catch(I){p(I)}}:r}var m,p,t=new b(function(q,r){m=q;p=r});this.i(k(d,m),k(g,p));return t};b.prototype.catch=function(d){return this.then(void 0,d)};b.prototype.i=function(d,g){function k(){switch(m.b){case 1:d(m.g);break;case 2:g(m.g);break;default:throw Error("Unexpected state: "+
m.b);}}var m=this;null==this.a?l.b(k):this.a.push(k)};b.resolve=e;b.reject=function(d){return new b(function(g,k){k(d)})};b.race=function(d){return new b(function(g,k){for(var m=n(d),p=m.next();!p.done;p=m.next())e(p.value).i(g,k)})};b.all=function(d){var g=n(d),k=g.next();return k.done?e([]):new b(function(m,p){function t(H){return function(I){q[H]=I;r--;0==r&&m(q)}}var q=[],r=0;do q.push(void 0),r++,e(k.value).i(t(q.length-1),p),k=g.next();while(!k.done)})};return b});
var v=["verse","group","search"],ca=v.indexOf("verse"),da=v.indexOf("group"),w=v.indexOf("search"),x=document.getElementById("verseDisplay"),y=document.getElementById("partSelect"),z=document.getElementById("verseSelect"),A=document.getElementById("verseGroupSelect"),B=document.getElementById("verseNavTop"),C=document.getElementById("verseNavBottom"),ea=B.cloneNode(!0),fa=document.querySelector(".verse-options"),D=document.getElementById("searchTxt"),ha=document.getElementById("searchBtn"),ia=document.getElementById("searchClearBtn"),
E=document.getElementById("searchResults"),ja=document.getElementById("groupView"),F={view:0,selectedPart:1,selectedVerse:1,selectedVerseGroup:"1:1-20",searchStr:"",verseOptions:{showRomanized:!0,showJapanese:!0,showEnglish:!0,showKanji:!0,showEnglish2:!1},groupOptions:{showRomanized:!0,showJapanese:!0,showEnglish:!1,showKanji:!1,showEnglish2:!1},searchOptions:{showRomanized:!0,showJapanese:!0,showEnglish:!0,showKanji:!0,showEnglish2:!1},isDataLoaded:!1},G=null,J=null;
function ka(){y.onchange=function(){K(parseInt(y.value,10))};z.onchange=function(){L(parseInt(z.value,10))};A.onchange=function(){M(A.value)};M(F.selectedVerseGroup);K(F.selectedPart);L(F.selectedVerse);N(F.view);D.onkeyup=function(a){13===a.keyCode&&O()};D.value=F.searchStr;ha.onclick=function(){O()};ia.onclick=function(){D.value="";D.focus()}}function O(){F.searchStr=D.value.trim();P()}function Q(){F.view===ca?R():F.view===da?S():F.view===w&&P()}
function K(a){F.selectedPart=a;y.value=F.selectedPart;F.selectedVerse=1;la(a);R()}function L(a){F.selectedVerse=a;z.value=F.selectedVerse;R()}function M(a){F.selectedVerseGroup=a;A.value=F.selectedVerseGroup;S()}function T(a){var b=G.verses.length;return 0>=a?G.verses[b-1]:a>b?G.verses[0]:G.verses[a-1]}function U(a,b){for(var c=G.verses.length,e=0;e<c;e++){var f=G.verses[e];if(f.part===a&&f.verse===b)return f}return null}
function N(a){v.map(function(e){var f=document.getElementById(e+"View");f&&(f.style.display="none");e=document.querySelectorAll("."+e+"-view");for(f=0;f<e.length;f++)e[f].style.display="none"});var b=v[a];document.getElementById(b+"View").style.display="block";b=document.querySelectorAll("."+b+"-view");for(var c=0;c<b.length;c++)b[c].style.display="block";a=a===w;B.style.display=a?"none":"block";C.style.display=a?"none":"block";Q()}
function R(){var a=F.selectedPart,b=F.selectedVerse;(J=U(a,b))?(ma(),x.innerHTML=V(J,"verse",null)):x.innerHTML="Verse "+a+":"+b+" not found!"}
function S(){var a=F.selectedVerseGroup.split(":"),b=parseInt(a[0],10);a=a[1];var c=a.split("-"),e=parseInt(c[1],10),f=[];for(c=parseInt(c[0],10);c<=e;c++)f.push(V(U(b,c),"group",null));ja.innerHTML=f.join("");var l="",d="";e=G.verseGroups[b-1];f=e.groups.length;for(c=0;c<f;c++)a===e.groups[c]&&(0<c?l=b+":"+e.groups[c-1]:1===b?(l=G.verseGroups[16].groups,l="17:"+l[l.length-1]):(l=b-1,d=G.verseGroups[l-1].groups,l=l+":"+d[d.length-1]),d=c<f-1?b+":"+e.groups[c+1]:17===b?"1:"+G.verseGroups[0].groups[0]:
b+1+":"+G.verseGroups[b].groups[0]);na(l,d)}function P(){var a=F.searchStr;if(a){for(var b=0,c=[],e=G.verses.length,f=0;f<e;f++){var l=G.verses[f];(l.ro+l.en_6th_ed+l.jp1+l.jp2+l.kanji).match(new RegExp(a,"i"))&&(b++,c.push(V(l,"search",a)))}c.unshift('<p>Search "'+a+'" yields '+b+" results.</p>");E.innerHTML=c.join("")}else E.innerHTML="<p>Enter a search term.</p>";D.select()}
function oa(){var a=[];G.verseGroups.map(function(b){var c=b.part;a.push('<option value="" disabled="true">- Part '+c+" -</option>");b.groups.map(function(e){e=c+":"+e;a.push('<option value="'+e+'">'+e+"</option>")})});A.innerHTML=a.join("")}function na(a,b){function c(){F.selectedVerseGroup=b;S()}function e(){F.selectedVerseGroup=a;S()}W(B,F.selectedVerseGroup,e,c);W(C,F.selectedVerseGroup,e,c)}
function ma(){function a(){K(f.part);L(f.verse)}function b(){K(e.part);L(e.verse)}var c="Verse "+J.part+":"+J.verse,e=T(J.id-1),f=T(J.id+1);W(B,c,b,a);W(C,c,b,a)}function W(a,b,c,e){a.innerHTML=ea.innerHTML;var f=a.getElementsByClassName("verse-nav-next-btn")[0],l=a.getElementsByClassName("verse-nav-middle")[0];a.getElementsByClassName("verse-nav-prev-btn")[0].onclick=c;f.onclick=e;l.innerHTML=b}
function V(a,b,c){c=c||!1;if(a){var e=a.part+":"+a.verse,f=X(a.ro.split(/\s{2,}/g).join("<br/>"),c),l=X(a.kanji.split(/\s{2,}/g).join("<br/>"),c),d=X(a.en_6th_ed,c);c=X(a.jp1+"<br/>"+a.jp2,c);return'<div class="verse-display">'+(F[b+"Options"].showRomanized?"<blockquote>"+f+"</blockquote>":"")+(F[b+"Options"].showJapanese?"<blockquote>"+c+"</blockquote>":"")+(F[b+"Options"].showEnglish?"<blockquote>"+d+"</blockquote>":"")+(F[b+"Options"].showKanji?"<blockquote>"+l+"</blockquote>":"")+'<table class="full-width"><tbody><tr><td>In Life of Oyasama?: '+
(a.in_life_of_oyasama?"&#9989;":"&#10060;")+"In Doctrine?: "+(a.in_doctrine?"&#9989;":"&#10060;")+"</td><td>"+e+"</td></tr></tbody></table></div>"}return"Verse not found."}function X(a,b){if(!b)return a;b=new RegExp(b,"i");var c='<span class="highlight">'+a.match(b)+"</span>";return a.replace(b,c)}
function pa(){v.map(function(a){for(var b=fa.cloneNode(!0),c=b.querySelectorAll("input"),e=b.querySelectorAll("label"),f={},l=0;l<c.length;f={h:f.h},l++){var d=c[l],g=d.id.replace("-verse","-"+a);f.h=d.id.replace("-verse","").replace("show","").replace("Cbx","");d.id=g;d.onchange=function(k){return function(){var m=k.h,p=document.getElementById("show"+m+"Cbx-"+a);if(p){var t=F[a+"Options"]["show"+m];"undefined"!==t&&(F[a+"Options"]["show"+m]=!t,p.checked=!t)}Q()}}(f);d.checked=F[a+"Options"]["show"+
f.h]}for(c=0;c<e.length;c++)e[c].htmlFor=e[c].htmlFor.replace("-verse","-"+a);e=document.getElementById(a+"OptionsRow");e.innerHTML="";e.appendChild(b);document.getElementById(a+"ViewMenuItem").onclick=function(){var k=v.indexOf(a);F.view=k;N(k)}})}function la(a){var b=[];G.verses.map(function(c){c.part===parseInt(a,10)&&(c=c.verse,b.push('<option value="'+c+'">'+c+"</option>"))});z.innerHTML=b.join("")}
window.onload=function(){qa();Y("ofudesaki.json").then(function(a){G=JSON.parse(a.responseText);return Y("keywords.json")}).then(function(a){JSON.parse(a.responseText);a=[];for(var b=1;18>=b;b++)a.push('<option value="'+b+'">'+b+"</option>");y.innerHTML=a.join("");oa();ka();pa()}).catch(function(a){console.log("Something went wrong.",a)})};window.onunload=function(){F.isDataLoaded&&window.localStorage.setItem("ofudesaki-browser",JSON.stringify(F))};
function qa(){var a=window.localStorage.getItem("ofudesaki-browser");a&&(a=JSON.parse(a))&&(F=a,F.isDataLoaded=!0)}function Y(a){var b=void 0===b?"GET":b;var c=new XMLHttpRequest;return new Promise(function(e,f){c.onreadystatechange=function(){4===c.readyState&&(200<=c.status&&300>c.status?e(c):f({status:c.status,statusText:c.statusText}))};c.open(b||"GET",a,!0);c.send()})}
function Z(a){for(var b=a.className.split(/\s+/),c=b.length,e=0;e<c;e++)if("active"===b[e]){b.splice(e,1);break}c===b.length&&b.push("active");a.className=b.join(" ")}(function(a,b){var c=b.getElementById("layout"),e=b.getElementById("menu"),f=b.getElementById("menuLink");a=b.getElementById("main");f.onclick=function(l){l.preventDefault();Z(c);Z(e);Z(f)};a.onclick=function(l){-1!==e.className.indexOf("active")&&(l.preventDefault(),Z(c),Z(e),Z(f))}})(window,window.document);
