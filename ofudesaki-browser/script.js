var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function h(a,b){if(b){var c=ba;a=a.split(".");for(var d=0;d<a.length-1;d++){var f=a[d];f in c||(c[f]={});c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}}
h("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}});h("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var f=d.length;c=c||0;for(0>c&&(c=Math.max(c+f,0));c<f;c++){var k=d[c];if(k===b||Object.is(k,b))return!0}return!1}});
h("String.prototype.includes",function(a){return a?a:function(b,c){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(b,c||0)}});function ca(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}
function da(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:ca(a)}}
h("Promise",function(a){function b(e){this.c=0;this.i=void 0;this.a=[];var g=this.g();try{e(g.resolve,g.reject)}catch(l){g.reject(l)}}function c(){this.a=null}function d(e){return e instanceof b?e:new b(function(g){g(e)})}if(a)return a;c.prototype.c=function(e){if(null==this.a){this.a=[];var g=this;this.g(function(){g.i()})}this.a.push(e)};var f=ba.setTimeout;c.prototype.g=function(e){f(e,0)};c.prototype.i=function(){for(;this.a&&this.a.length;){var e=this.a;this.a=[];for(var g=0;g<e.length;++g){var l=
e[g];e[g]=null;try{l()}catch(m){this.h(m)}}}this.a=null};c.prototype.h=function(e){this.g(function(){throw e;})};b.prototype.g=function(){function e(m){return function(q){l||(l=!0,m.call(g,q))}}var g=this,l=!1;return{resolve:e(this.w),reject:e(this.h)}};b.prototype.w=function(e){if(e===this)this.h(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof b)this.A(e);else{a:switch(typeof e){case "object":var g=null!=e;break a;case "function":g=!0;break a;default:g=!1}g?this.v(e):this.m(e)}};
b.prototype.v=function(e){var g=void 0;try{g=e.then}catch(l){this.h(l);return}"function"==typeof g?this.B(g,e):this.m(e)};b.prototype.h=function(e){this.o(2,e)};b.prototype.m=function(e){this.o(1,e)};b.prototype.o=function(e,g){if(0!=this.c)throw Error("Cannot settle("+e+", "+g+"): Promise already settled in state"+this.c);this.c=e;this.i=g;this.u()};b.prototype.u=function(){if(null!=this.a){for(var e=0;e<this.a.length;++e)k.c(this.a[e]);this.a=null}};var k=new c;b.prototype.A=function(e){var g=this.g();
e.l(g.resolve,g.reject)};b.prototype.B=function(e,g){var l=this.g();try{e.call(g,l.resolve,l.reject)}catch(m){l.reject(m)}};b.prototype.then=function(e,g){function l(t,w){return"function"==typeof t?function(X){try{m(t(X))}catch(Y){q(Y)}}:w}var m,q,u=new b(function(t,w){m=t;q=w});this.l(l(e,m),l(g,q));return u};b.prototype.catch=function(e){return this.then(void 0,e)};b.prototype.l=function(e,g){function l(){switch(m.c){case 1:e(m.i);break;case 2:g(m.i);break;default:throw Error("Unexpected state: "+
m.c);}}var m=this;null==this.a?k.c(l):this.a.push(l)};b.resolve=d;b.reject=function(e){return new b(function(g,l){l(e)})};b.race=function(e){return new b(function(g,l){for(var m=da(e),q=m.next();!q.done;q=m.next())d(q.value).l(g,l)})};b.all=function(e){var g=da(e),l=g.next();return l.done?d([]):new b(function(m,q){function u(X){return function(Y){t[X]=Y;w--;0==w&&m(t)}}var t=[],w=0;do t.push(void 0),w++,d(l.value).l(u(t.length-1),q),l=g.next();while(!l.done)})};return b});
var n=["verse","group","search","favorites"],ea=n.indexOf("verse"),fa=n.indexOf("group"),ha=n.indexOf("search"),p=n.indexOf("favorites"),ia=document.getElementById("verseDisplay"),r=document.getElementById("partSelect"),v=document.getElementById("verseSelect"),x=document.getElementById("verseGroupSelect"),y=document.getElementById("verseNavTop"),z=document.getElementById("verseNavBottom"),ja=y.cloneNode(!0),ka=document.getElementById("bookmarkDisplay"),A=document.getElementById("favoritesDisplay"),
la=document.querySelector(".verse-options"),B=document.getElementById("searchTxt"),ma=document.getElementById("searchBtn"),na=document.getElementById("searchClearBtn"),C=document.getElementById("searchResults"),D=document.getElementById("groupView"),oa=document.getElementById("hideButtonLabelCbx"),E={view:0,selectedPart:1,selectedVerse:1,selectedVerseGroup:"1:1-20",searchStr:"",hideButtonLabel:!1,verseOptions:{showRomanized:!0,showJapanese:!0,showEnglish:!0,showPortuguese:!0,showKanji:!0,showEnglish2:!1},
groupOptions:{showRomanized:!0,showJapanese:!0,showEnglish:!0,showPortuguese:!0,showKanji:!1,showEnglish2:!1},searchOptions:{showRomanized:!0,showJapanese:!0,showEnglish:!0,showPortuguese:!0,showKanji:!0,showEnglish2:!1},favoritesOptions:{showRomanized:!0,showJapanese:!0,showEnglish:!0,showPortuguese:!0,showKanji:!0,showEnglish2:!1},isDataLoaded:!1},F={favorites:[],bookmark:0},G=null,H=null;
function pa(){r.onchange=function(){I(parseInt(r.value,10));J(1);K()};v.onchange=function(){J(parseInt(v.value,10));K()};x.onchange=function(){L(x.value);M()};L(E.selectedVerseGroup);I(E.selectedPart);J(E.selectedVerse);N(E.view);B.onkeyup=function(a){13===a.keyCode&&qa()};B.value=E.searchStr;ma.onclick=function(){qa()};na.onclick=function(){B.value="";B.focus()};ra()}
function ra(){var a=document.querySelector(".of-bottom-menu");E.hideButtonLabel&&sa(a,"of-hide-labels");oa.checked=E.hideButtonLabel;oa.onclick=function(){var b=E.hideButtonLabel;"undefined"===b&&(b=!1);E.hideButtonLabel=!b;oa.checked=!b;b?ta(a,"of-hide-labels"):sa(a,"of-hide-labels");O()}}function qa(){E.searchStr=B.value.trim();ua()}function P(){E.view===ea?K():E.view===fa?M():E.view===ha?ua():E.view===p&&va()}function I(a){E.selectedPart=a;r.value=E.selectedPart;wa(a)}
function J(a){E.selectedVerse=a;v.value=E.selectedVerse}function L(a){E.selectedVerseGroup=a;x.value=E.selectedVerseGroup}function xa(a){var b=G.verses.length;return 0>=a?G.verses[b-1]:a>b?G.verses[0]:G.verses[a-1]}function Q(a,b){for(var c=G.verses.length,d=0;d<c;d++){var f=G.verses[d];if(f.part===a&&f.verse===b)return f}return null}
function N(a){E.view=a;n.map(function(d){var f=document.getElementById(d+"View");f&&(f.style.display="none");f=document.querySelectorAll("."+d+"-view");for(var k=0;k<f.length;k++)f[k].style.display="none";(f=document.getElementById(d+"ViewMenuItem"))||console.error("ERROR: "+d+"ViewMenuItem not found.");ta(f,"selected")});a=n[a];var b=document.getElementById(a+"View"),c=document.querySelectorAll("."+a+"-view");b.style.display="";b.classList.add("animated","fadeIn");b.addEventListener("animationend",
function(){});for(b=0;b<c.length;b++)c[b].style.display="";sa(document.querySelector("#"+a+"ViewMenuItem"),"selected");O();P()}function K(){y.style.display="";z.style.display="";var a=E.selectedPart,b=E.selectedVerse;(H=Q(a,b))?(ya(),ia.innerHTML=R(H,"verse",null),S(ia,H)):ia.innerHTML="Verse "+a+":"+b+" not found!"}
function S(a,b){if(a&&b){var c=a.querySelector(".verse-btn"),d=a.querySelector(".read-btn"),f=a.querySelector(".favorite-btn"),k=a.querySelector(".bookmark-btn"),e=b.b,g=b.f;if(e&&g&&f){var l=e+":"+g;c&&(c.onclick=function(){I(e);J(g);N(ea)});if(d){var m=za(e,g);d.onclick=function(){L(m);N(fa);window.location.hash="verse"+e+"-"+g}}(a=-1<F.favorites.indexOf(l))&&f.classList.add("favorited");f.title=(a?"Remove from ":"Add to")+" Favorites";f.addEventListener("animationend",function(){f.classList.remove("animated",
"shake","tada");P()});l===F.bookmark?(k.classList.add("favorited"),k.title="Remove Bookmark"):k.title="Bookmark";k.addEventListener("animationend",function(){k.classList.remove("animated","pulse","tada");P()});f.onclick=function(){F.favorites.includes(l)?(F.favorites.splice(F.favorites.indexOf(l),1),f.classList.remove("favorited"),E.view===p?Aa(f.parentNode.parentNode.parentNode.parentNode.parentNode,function(){T();P()}):(f.classList.add("animated","shake"),T())):(F.favorites.push(l),F.favorites.sort(Ba),
f.classList.add("favorited","animated","tada"),T())};k.onclick=function(){F.bookmark===l?(F.bookmark=!1,k.classList.remove("favorited"),E.view===p?Aa(k.parentNode.parentNode.parentNode.parentNode.parentNode,function(){T();P()}):(k.classList.add("animated","shake"),T())):F.bookmark!==l&&(F.bookmark=l,k.classList.add("favorited","animated","tada"),T())}}}}
function Aa(a,b){console.log("animateElem animation=slideOutRight");a&&(a.classList.add("animated","slideOutRight"),a.addEventListener("animationend",function(){a.classList.remove("animated","slideOutRight");b&&b()}))}function U(a){if(a&&-1<a.indexOf(":")){var b=a.split(":");a=parseInt(b[0],10);b=parseInt(b[1],10);if(a&&b)return{b:a,f:b}}return null}function Ba(a,b){a=U(a);var c=U(b);return!a&&c?-1:a&&!c?1:a.b<c.b?-1:a.b>c.b?1:a.f<b.f?-1:a.f>c.f?1:0}
function za(a,b){if(a&&b){var c=G.verseGroups[a-1].groups;if(c)for(var d=0;d<c.length;d++){var f=c[d],k=f.split("-"),e=parseInt(k[1],10);if(b>=parseInt(k[0],10)&&b<=e)return a+":"+f}console.error("ERROR: getVerseGroupByPartVerse parameters ("+a+", "+b+") not found.");return null}console.error("ERROR: getVerseGroupByPartVerse parameters (part, verse) are not valid.")}
function M(){y.style.display="";z.style.display="";var a;if(a=E.selectedVerseGroup){a=a.split(":");var b=a[1],c=b.split("-");a={b:parseInt(a[0],10),C:parseInt(c[0],10),s:parseInt(c[1],10),D:b}}else a=null;if(a){D.innerHTML="";for(b=a.C;b<=a.s;b++){c=Q(a.b,b);var d=document.createElement("div");d.innerHTML=R(c,"group",null);S(d,c);D.appendChild(d)}b=a.b;var f="",k="";c=G.verseGroups[b-1];d=c.groups.length;for(var e=0;e<d;e++)a.D===c.groups[e]&&(0<e?f=b+":"+c.groups[e-1]:1===b?(f=G.verseGroups[16].groups,
f="17:"+f[f.length-1]):(f=b-1,k=G.verseGroups[f-1].groups,f=f+":"+k[k.length-1]),k=e<d-1?b+":"+c.groups[e+1]:17===b?"1:"+G.verseGroups[0].groups[0]:b+1+":"+G.verseGroups[b].groups[0]);Ca(f,k)}}
function va(){y.style.display="none";z.style.display="none";var a=F.bookmark,b=F.favorites;if(a){var c=U(F.bookmark);ka.innerHTML="<h3>Bookmark</h3>"+R(Q(c.b,c.f),"favorites","");S(ka,c)}else ka.innerHTML="";b&&0<b.length?(A.innerHTML='<h3 style="border-bottom: 1px solid gray;">Favorites</h3>',b.map(function(d){if(d=U(d)){var f=document.createElement("div");f.innerHTML=R(Q(d.b,d.f),"favorites","");S(f,d);A.appendChild(f)}})):A.innerHTML="";a||b&&0!==b.length||(A.innerHTML="Bookmark and favorites have not been set.")}
function ua(){y.style.display="none";z.style.display="none";var a=E.searchStr;if(a){var b=0,c=[],d=G.verses.length;C.innerHTML="";for(var f=0;f<d;f++){var k=G.verses[f],e=new RegExp(a,"i"),g=document.createElement("div"),l=[];E.searchOptions.showRomanized&&l.push(k.ro);E.searchOptions.showJapanese&&l.push(k.jp1+k.jp2);E.searchOptions.showEnglish&&l.push(k.en_6th_ed);E.searchOptions.showPortuguese&&l.push(k.pt);E.searchOptions.showKanji&&l.push(k.kanji);l.join(" ").match(e)&&(b++,g.innerHTML=R(k,"search",
a),S(g,k),c.push(g))}d=document.createElement("div");d.innerHTML='<p>Search "'+a+'" yields '+b+" results.</p>";C.appendChild(d);for(a=0;a<c.length;a++)C.appendChild(c[a])}else C.innerHTML="<p>Enter a search term.</p>";B.select()}function Da(){var a=[];G.verseGroups.map(function(b){var c=b.part;a.push('<option value="" disabled="true">- Part '+c+" -</option>");b.groups.map(function(d){d=c+":"+d;a.push('<option value="'+d+'">'+d+"</option>")})});x.innerHTML=a.join("")}
function Ca(a,b){function c(){D.classList.add("animated","slideOutLeft");D.addEventListener("animationend",function(){L(b);M();D.className="";D.classList.add("animated","slideInRight");D.addEventListener("animationend",function(){D.className=""})})}function d(){D.classList.add("animated","slideOutRight");D.addEventListener("animationend",function(){L(a);M();D.className="";D.classList.add("animated","slideInLeft");D.addEventListener("animationend",function(){D.className=""})})}V(y,E.selectedVerseGroup,
d,c);V(z,E.selectedVerseGroup,d,c)}function ya(){function a(){I(f.part);J(f.verse);K()}function b(){I(d.part);J(d.verse);K()}var c="Verse "+H.part+":"+H.verse,d=xa(H.id-1),f=xa(H.id+1);V(y,c,b,a);V(z,c,b,a)}function V(a,b,c,d){a.innerHTML=ja.innerHTML;var f=a.getElementsByClassName("verse-nav-next-btn")[0],k=a.getElementsByClassName("verse-nav-middle")[0];a.getElementsByClassName("verse-nav-prev-btn")[0].onclick=c;f.onclick=d;k.innerHTML=b}
function R(a,b,c){c=c||!1;if(a){var d=a.part+":"+a.verse,f=W(a.ro.split(/\s{2,}/g).join("<br/>"),c),k=W(a.kanji.split(/\s{2,}/g).join("<br/>"),c),e=W(a.en_6th_ed,c),g=W(a.pt,c);c=W(a.jp1+"<br/>"+a.jp2,c);return'<div class="verse-display">'+(E[b+"Options"].showRomanized?"<blockquote>"+f+"</blockquote>":"")+(E[b+"Options"].showJapanese?"<blockquote>"+c+"</blockquote>":"")+(E[b+"Options"].showEnglish?"<blockquote>"+e+"</blockquote>":"")+(E[b+"Options"].showPortuguese?"<blockquote>"+g+"</blockquote>":
"")+(E[b+"Options"].showKanji?"<blockquote>"+k+"</blockquote>":"")+'<table class="of-verse-controls"><tbody><tr><td><button class="favorite-btn btn circle"><i class="fa fa-fw fa-star"></i></button><button class="bookmark-btn btn circle"><i class="fa fa-fw fa-bookmark"></i></button></td><td>'+(a.in_life_of_oyasama?'<span class="of-tag">Life of Oyasama</span>':"")+(a.in_doctrine?'<span class="of-tag">Doctrine</span>':"")+"</td><td>"+d+"</td><td>"+("group"!==b?'<button class="read-btn btn circle" title="View in Read"><i class="fab fa-fw fa-readme"></i></button>':
"")+("verse"!==b?'<button class="verse-btn btn circle" title="View in Browse"><i class="fa fa-fw fa-eye"></i></button>':"")+"</td></tr></tbody></table></div>"}return"Verse not found."}function W(a,b){if(!b)return a;b=new RegExp(b,"i");var c='<span class="highlight">'+a.match(b)+"</span>";return a.replace(b,c)}
function Ea(){n.map(function(a){for(var b=la.cloneNode(!0),c=b.querySelectorAll("input"),d=b.querySelectorAll("label"),f={},k=0;k<c.length;f={j:f.j},k++){var e=c[k],g=e.id.replace("-verse","-"+a);f.j=e.id.replace("-verse","").replace("show","").replace("Cbx","");e.id=g;e.onchange=function(l){return function(){var m=l.j,q=document.getElementById("show"+m+"Cbx-"+a);if(q){var u=E[a+"Options"]["show"+m];"undefined"===u&&(u=!1);E[a+"Options"]["show"+m]=!u;q.checked=!u}P()}}(f);e.checked=E[a+"Options"]["show"+
f.j]}for(c=0;c<d.length;c++)d[c].htmlFor=d[c].htmlFor.replace("-verse","-"+a);d=document.getElementById(a+"OptionsRow");d.innerHTML="";d.appendChild(b);document.getElementById(a+"ViewMenuItem").onclick=function(){N(n.indexOf(a))}})}function wa(a){var b=[];G.verses.map(function(c){c.part===parseInt(a,10)&&(c=c.verse,b.push('<option value="'+c+'"'+(E.selectedVerse===c?' selected="selected"':"")+">"+c+"</option>"))});v.innerHTML=b.join("");v.value=E.selectedVerse}
window.onload=function(){Fa().then(function(){return Ga("ofudesaki.json")}).then(function(a){G=JSON.parse(a.responseText);return Ga("keywords.json")}).then(function(a){JSON.parse(a.responseText);O();a=[];for(var b=1;18>=b;b++)a.push('<option value="'+b+'">'+b+"</option>");r.innerHTML=a.join("");wa(E.selectedPart);Da();pa();Ea();E.isDataLoaded=!0}).catch(function(a){console.error("Something went wrong.",a)})};window.onunload=function(){E.isDataLoaded&&(O(),T())};
function Fa(){return new Promise(function(a,b){var c=window.localStorage.getItem("ofudesaki-browser"),d=window.localStorage.getItem("ofudesaki-browser-favorites");c&&((c=JSON.parse(c))?(E=c,E.favoritesOptions||(E.favoritesOptions={showRomanized:!0,showJapanese:!0,showEnglish:!0,showPortuguese:!0,showKanji:!0,showEnglish2:!1})):b(Error("Failed to load data from local storage.")));d&&((d=JSON.parse(d))?F=d:b(Error("Failed to load fav data from local storage.")));a("Data loaded from local storage.")})}
function O(){window.localStorage.setItem("ofudesaki-browser",JSON.stringify(E))}function T(){window.localStorage.setItem("ofudesaki-browser-favorites",JSON.stringify(F))}function Ga(a){var b=void 0===b?"GET":b;var c=new XMLHttpRequest;return new Promise(function(d,f){c.onreadystatechange=function(){4===c.readyState&&(200<=c.status&&300>c.status?d(c):f({status:c.status,statusText:c.statusText}))};c.open(b||"GET",a,!0);c.send()})}
function Z(a){for(var b=a.className.split(/\s+/),c=b.length,d=0;d<c;d++)if("active"===b[d]){b.splice(d,1);break}c===b.length&&b.push("active");a.className=b.join(" ")}function ta(a,b){for(var c=a.className.split(/\s+/),d=c.length,f=0;f<d;f++)if(c[f]===b){c.splice(f,1);break}a.className=c.join(" ")}function sa(a,b){var c=a.className.split(/\s+/);c.push(b);a.className=c.join(" ")}
(function(a,b){var c=b.getElementById("layout"),d=b.getElementById("menu"),f=b.getElementById("menuLink");a=b.getElementById("main");f.onclick=function(k){k.preventDefault();Z(c);Z(d);Z(f)};a.onclick=function(k){-1!==d.className.indexOf("active")&&(k.preventDefault(),Z(c),Z(d),Z(f))}})(window,window.document);
