function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function h(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:aa(a)}}var p="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,ba="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
function ca(a,b){if(b){var c=p;a=a.split(".");for(var e=0;e<a.length-1;e++){var g=a[e];g in c||(c[g]={});c=c[g]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&ba(c,a,{configurable:!0,writable:!0,value:b})}}
ca("Promise",function(a){function b(d){this.b=0;this.g=void 0;this.a=[];var f=this.c();try{d(f.resolve,f.reject)}catch(l){f.reject(l)}}function c(){this.a=null}function e(d){return d instanceof b?d:new b(function(f){f(d)})}if(a)return a;c.prototype.b=function(d){if(null==this.a){this.a=[];var f=this;this.c(function(){f.g()})}this.a.push(d)};var g=p.setTimeout;c.prototype.c=function(d){g(d,0)};c.prototype.g=function(){for(;this.a&&this.a.length;){var d=this.a;this.a=[];for(var f=0;f<d.length;++f){var l=
d[f];d[f]=null;try{l()}catch(m){this.f(m)}}}this.a=null};c.prototype.f=function(d){this.c(function(){throw d;})};b.prototype.c=function(){function d(m){return function(n){l||(l=!0,m.call(f,n))}}var f=this,l=!1;return{resolve:d(this.s),reject:d(this.f)}};b.prototype.s=function(d){if(d===this)this.f(new TypeError("A Promise cannot resolve to itself"));else if(d instanceof b)this.u(d);else{a:switch(typeof d){case "object":var f=null!=d;break a;case "function":f=!0;break a;default:f=!1}f?this.o(d):this.j(d)}};
b.prototype.o=function(d){var f=void 0;try{f=d.then}catch(l){this.f(l);return}"function"==typeof f?this.v(f,d):this.j(d)};b.prototype.f=function(d){this.l(2,d)};b.prototype.j=function(d){this.l(1,d)};b.prototype.l=function(d,f){if(0!=this.b)throw Error("Cannot settle("+d+", "+f+"): Promise already settled in state"+this.b);this.b=d;this.g=f;this.m()};b.prototype.m=function(){if(null!=this.a){for(var d=0;d<this.a.length;++d)k.b(this.a[d]);this.a=null}};var k=new c;b.prototype.u=function(d){var f=this.c();
d.i(f.resolve,f.reject)};b.prototype.v=function(d,f){var l=this.c();try{d.call(f,l.resolve,l.reject)}catch(m){l.reject(m)}};b.prototype.then=function(d,f){function l(q,r){return"function"==typeof q?function(J){try{m(q(J))}catch(K){n(K)}}:r}var m,n,t=new b(function(q,r){m=q;n=r});this.i(l(d,m),l(f,n));return t};b.prototype.catch=function(d){return this.then(void 0,d)};b.prototype.i=function(d,f){function l(){switch(m.b){case 1:d(m.g);break;case 2:f(m.g);break;default:throw Error("Unexpected state: "+
m.b);}}var m=this;null==this.a?k.b(l):this.a.push(l)};b.resolve=e;b.reject=function(d){return new b(function(f,l){l(d)})};b.race=function(d){return new b(function(f,l){for(var m=h(d),n=m.next();!n.done;n=m.next())e(n.value).i(f,l)})};b.all=function(d){var f=h(d),l=f.next();return l.done?e([]):new b(function(m,n){function t(J){return function(K){q[J]=K;r--;0==r&&m(q)}}var q=[],r=0;do q.push(void 0),r++,e(l.value).i(t(q.length-1),n),l=f.next();while(!l.done)})};return b});
var u=["verse","group","search"],da=u.indexOf("verse"),ea=u.indexOf("group"),v=u.indexOf("search"),w=document.getElementById("verseDisplay"),x=document.getElementById("partSelect"),y=document.getElementById("verseSelect"),z=document.getElementById("verseGroupSelect"),A=document.getElementById("verseNavTop"),B=document.getElementById("verseNavBottom"),fa=A.cloneNode(!0),ha=document.querySelector(".verse-options"),C=document.getElementById("searchTxt"),ia=document.getElementById("searchBtn"),ja=document.getElementById("searchClearBtn"),
D=document.getElementById("searchResults"),ka=document.getElementById("groupView"),E={view:0,selectedPart:1,selectedVerse:1,selectedVerseGroup:"1:1-20",searchStr:"",verseOptions:{showRomanized:!0,showJapanese:!0,showEnglish:!0,showPortuguese:!1,showKanji:!0,showEnglish2:!1},groupOptions:{showRomanized:!0,showJapanese:!0,showEnglish:!1,showPortuguese:!1,showKanji:!1,showEnglish2:!1},searchOptions:{showRomanized:!0,showJapanese:!0,showEnglish:!0,showPortuguese:!1,showKanji:!0,showEnglish2:!1},isDataLoaded:!1},
F=null,G=null;function la(){x.onchange=function(){H(parseInt(x.value,10));I(1);L()};y.onchange=function(){I(parseInt(y.value,10));L()};z.onchange=function(){M(z.value);N()};M(E.selectedVerseGroup);H(E.selectedPart);y.value=E.selectedVerse;O(E.view);C.onkeyup=function(a){13===a.keyCode&&P()};C.value=E.searchStr;ia.onclick=function(){P()};ja.onclick=function(){C.value="";C.focus()}}function P(){E.searchStr=C.value.trim();Q()}function R(){E.view===da?L():E.view===ea?N():E.view===v&&Q()}
function H(a){E.selectedPart=a;x.value=E.selectedPart;S(a)}function I(a){console.log("selectVerse(verseNum) verseNum="+a);E.selectedVerse=a;y.value=E.selectedVerse}function M(a){E.selectedVerseGroup=a;z.value=E.selectedVerseGroup}function T(a){var b=F.verses.length;return 0>=a?F.verses[b-1]:a>b?F.verses[0]:F.verses[a-1]}function U(a,b){for(var c=F.verses.length,e=0;e<c;e++){var g=F.verses[e];if(g.part===a&&g.verse===b)return g}return null}
function O(a){u.map(function(e){var g=document.getElementById(e+"View");g&&(g.style.display="none");e=document.querySelectorAll("."+e+"-view");for(g=0;g<e.length;g++)e[g].style.display="none"});var b=u[a];document.getElementById(b+"View").style.display="block";b=document.querySelectorAll("."+b+"-view");for(var c=0;c<b.length;c++)b[c].style.display="block";a=a===v;A.style.display=a?"none":"block";B.style.display=a?"none":"block";R()}
function L(){var a=E.selectedPart,b=E.selectedVerse;(G=U(a,b))?(ma(),w.innerHTML=V(G,"verse",null)):w.innerHTML="Verse "+a+":"+b+" not found!"}
function N(){var a=E.selectedVerseGroup.split(":"),b=parseInt(a[0],10);a=a[1];var c=a.split("-"),e=parseInt(c[1],10),g=[];for(c=parseInt(c[0],10);c<=e;c++)g.push(V(U(b,c),"group",null));ka.innerHTML=g.join("");var k="";e=F.verseGroups[b-1];g=e.groups.length;for(c=0;c<g;c++)if(a===e.groups[c])if(0<c)k=b+":"+e.groups[c-1];else if(1===b)k=F.verseGroups[16].groups,k="17:"+k[k.length-1];else{k=b-1;var d=F.verseGroups[k-1].groups;k=k+":"+d[d.length-1]}na(k)}
function Q(){var a=E.searchStr;if(a){for(var b=0,c=[],e=F.verses.length,g=0;g<e;g++){var k=F.verses[g],d=new RegExp(a,"i"),f=[];E.searchOptions.showRomanized&&f.push(k.ro);E.searchOptions.showJapanese&&f.push(k.jp1+k.jp2);E.searchOptions.showEnglish&&f.push(k.en_6th_ed);E.searchOptions.showPortuguese&&f.push(k.pt);E.searchOptions.showKanji&&f.push(k.kanji);f.join(" ").match(d)&&(b++,c.push(V(k,"search",a)))}c.unshift('<p>Search "'+a+'" yields '+b+" results.</p>");D.innerHTML=c.join("")}else D.innerHTML=
"<p>Enter a search term.</p>";C.select()}function oa(){var a=[];F.verseGroups.map(function(b){var c=b.part;a.push('<option value="" disabled="true">- Part '+c+" -</option>");b.groups.map(function(e){e=c+":"+e;a.push('<option value="'+e+'">'+e+"</option>")})});z.innerHTML=a.join("")}function na(a){function b(){M(a);N()}function c(){M(a);N()}W(A,E.selectedVerseGroup,c,b);W(B,E.selectedVerseGroup,c,b)}
function ma(){function a(){H(g.part);I(g.verse);L()}function b(){H(e.part);I(e.verse);L()}var c="Verse "+G.part+":"+G.verse,e=T(G.id-1),g=T(G.id+1);W(A,c,b,a);W(B,c,b,a)}function W(a,b,c,e){a.innerHTML=fa.innerHTML;var g=a.getElementsByClassName("verse-nav-next-btn")[0],k=a.getElementsByClassName("verse-nav-middle")[0];a.getElementsByClassName("verse-nav-prev-btn")[0].onclick=c;g.onclick=e;k.innerHTML=b}
function V(a,b,c){c=c||!1;if(a){var e=a.part+":"+a.verse,g=X(a.ro.split(/\s{2,}/g).join("<br/>"),c),k=X(a.kanji.split(/\s{2,}/g).join("<br/>"),c),d=X(a.en_6th_ed,c),f=X(a.pt,c);c=X(a.jp1+"<br/>"+a.jp2,c);return'<div class="verse-display">'+(E[b+"Options"].showRomanized?"<blockquote>"+g+"</blockquote>":"")+(E[b+"Options"].showJapanese?"<blockquote>"+c+"</blockquote>":"")+(E[b+"Options"].showEnglish?"<blockquote>"+d+"</blockquote>":"")+(E[b+"Options"].showPortuguese?"<blockquote>"+f+"</blockquote>":
"")+(E[b+"Options"].showKanji?"<blockquote>"+k+"</blockquote>":"")+'<table class="full-width"><tbody><tr><td>In Life of Oyasama?: '+(a.in_life_of_oyasama?"&#9989;":"&#10060;")+"In Doctrine?: "+(a.in_doctrine?"&#9989;":"&#10060;")+"</td><td>"+e+"</td></tr></tbody></table></div>"}return"Verse not found."}function X(a,b){if(!b)return a;b=new RegExp(b,"i");var c='<span class="highlight">'+a.match(b)+"</span>";return a.replace(b,c)}
function pa(){u.map(function(a){for(var b=ha.cloneNode(!0),c=b.querySelectorAll("input"),e=b.querySelectorAll("label"),g={},k=0;k<c.length;g={h:g.h},k++){var d=c[k],f=d.id.replace("-verse","-"+a);g.h=d.id.replace("-verse","").replace("show","").replace("Cbx","");d.id=f;d.onchange=function(l){return function(){var m=l.h,n=document.getElementById("show"+m+"Cbx-"+a);if(n){var t=E[a+"Options"]["show"+m];"undefined"!==t&&(E[a+"Options"]["show"+m]=!t,n.checked=!t)}R()}}(g);d.checked=E[a+"Options"]["show"+
g.h]}for(c=0;c<e.length;c++)e[c].htmlFor=e[c].htmlFor.replace("-verse","-"+a);e=document.getElementById(a+"OptionsRow");e.innerHTML="";e.appendChild(b);document.getElementById(a+"ViewMenuItem").onclick=function(){var l=u.indexOf(a);E.view=l;O(l)}})}function S(a){var b=[];F.verses.map(function(c){c.part===parseInt(a,10)&&(c=c.verse,b.push('<option value="'+c+'"'+(E.selectedVerse===c?' selected="selected"':"")+">"+c+"</option>"))});y.innerHTML=b.join("");y.value=E.selectedVerse}
window.onload=function(){qa().then(function(){console.log("111 selectedVerse="+E.selectedVerse);Y("ofudesaki.json").then(function(a){F=JSON.parse(a.responseText);return Y("keywords.json")}).then(function(a){JSON.parse(a.responseText);a=[];for(var b=1;18>=b;b++)a.push('<option value="'+b+'">'+b+"</option>");x.innerHTML=a.join("");S(E.selectedPart);oa();la();pa();E.isDataLoaded=!0}).catch(function(a){console.log("Something went wrong.",a)})})};
window.onunload=function(){E.isDataLoaded&&window.localStorage.setItem("ofudesaki-browser",JSON.stringify(E))};function qa(){return new Promise(function(a,b){var c=window.localStorage.getItem("ofudesaki-browser");c&&((c=JSON.parse(c))?(E=c,a("Data loaded from local storage.")):b(Error("Failed to load data from local storage.")))})}
function Y(a){var b=void 0===b?"GET":b;var c=new XMLHttpRequest;return new Promise(function(e,g){c.onreadystatechange=function(){4===c.readyState&&(200<=c.status&&300>c.status?e(c):g({status:c.status,statusText:c.statusText}))};c.open(b||"GET",a,!0);c.send()})}function Z(a){for(var b=a.className.split(/\s+/),c=b.length,e=0;e<c;e++)if("active"===b[e]){b.splice(e,1);break}c===b.length&&b.push("active");a.className=b.join(" ")}
(function(a,b){var c=b.getElementById("layout"),e=b.getElementById("menu"),g=b.getElementById("menuLink");a=b.getElementById("main");g.onclick=function(k){k.preventDefault();Z(c);Z(e);Z(g)};a.onclick=function(k){-1!==e.className.indexOf("active")&&(k.preventDefault(),Z(c),Z(e),Z(g))}})(window,window.document);
