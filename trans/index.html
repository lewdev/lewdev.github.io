<html>
<head>
<title>trans</title>
<style>
body, li, div, span, input, select, option { font-size: 15px; font-family: arial; }
li { margin-bottom: .5em; }
.trans-table { width: 100%; border-collapse: collapse; }
.trans-table > tbody > tr > td:first-child { width: 100%; }
.trans-table > tbody > tr > td { padding: 0; margin: 0; width: 10px;}

@media screen and (min-width: 480px) {
  body, li, div, span, input, select, option { font-size: 30px; }
}
@media screen and (min-width: 1024px) {
  body, li, div, span, input, select, option { font-size: 20px; }
}
</style>
</head>
<body>
  <table class="trans-table">
    <tbody>
    <tr>
      <td class="trans-url-input">
        <input id="url" type="text" style="width:100%"
          onclick="this.select();"
          onkeypress="if(event.keyCode == 13){trans();this.value='';}" />
      </td>

      <td class="trans-lang-select">
        <select id="langSource" onchange="onLangChange();">
          <option value="ja">ja</option>
          <option value="en">en</option>
          <option value="lo">lo</option>
        </select>
      </td>
      <td>
        <select id="langTarget" onchange="onLangChange();">
          <option value="en">en</option>
          <option value="ja">ja</option>
          <option value="lo">lo</option>
        </select>
      </td>

      <td>
        <input type="button" value="clear all" onclick="clearAllData();"/>
      </td>

      <td class="trans-url-buttons">
        <input type="button" value="trans" onclick="trans();document.getElementById('url').value='';"/>
      </td>
    </tr>
    </tbody>
  </table>

  <ul id="urlList"></ul>

  <script>
  var urlList = []
    , langSource = 'ja'
    , langTarget = 'en'
    , GTRANS_URL = 'https://translate.google.com/translate?hl=en&sl={langSource}&tl={langTarget}&anno=2&sandbox=1&u='
  ;
  function trans() {
    var urlInput = document.getElementById("url")
      , targetUrl = urlInput.value
    ;
    if (targetUrl == '') {
      return;
    }
    addUrlToList(targetUrl, urlList.length);
  }

  function addUrlToList(targetUrl, index) {
    addUrlToListInUi(targetUrl, index);

    urlList.push(targetUrl);
    //save urls
    persistData();
  }

  function onLangChange() {
    var urlListElem = document.getElementById("urlList");
    urlListElem.innerHTML = "";

    var size = urlList.length, i;
    for (i = 0; i < size; i++) {
      addUrlToListInUi(urlList[i], i);
    }
    var langSourceSelect = document.getElementById("langSource")
      , langTargetSelect = document.getElementById("langTarget")
    ;
    langSource = langSourceSelect ? langSourceSelect.value : "ja"
    langTarget = langTargetSelect ? langTargetSelect.value : "en";
    persistData();
  }

  function addUrlToListInUi(targetUrl, index) {
    var langSourceSelect = document.getElementById("langSource")
      , langTargetSelect = document.getElementById("langTarget")
    ;
    langSource = langSourceSelect ? langSourceSelect.value : "ja"
    langTarget = langTargetSelect ? langTargetSelect.value : "en";

    var transUrl = GTRANS_URL.replace(/\{langSource\}/g, langSource).replace(/\{langTarget\}/g, langTarget) + targetUrl.trim()
      , urlListElem = document.getElementById("urlList")
      , li = document.createElement("li")
      , link = '<a href="' + transUrl + '" target="_blank">' + targetUrl + '</a>'
          //+ ' ' + langSource + '&rArr;' + langTarget //&hArr;
          + ' (<a href="#" onclick="deleteLink(' + index + ', this);">x</a>)'
    ;

    if (urlListElem) {
      li.innerHTML = link;
      urlListElem.appendChild(li);
    }
    else {
      alert("URL list element not found!");
    }
    document.getElementById('url').focus();
  }

  function deleteLink(index, elem) {
    var parent = elem.parentNode;
    parent.parentNode.removeChild(parent);
    urlList.splice(index, 1);
    //console.log("deleteLink removed link! urlList.length=" + urlList.length);
    persistData();
    return false;
  }

  window.onload = function() {
    if (!supportsHtml5Storage()) {
      alert("Local Storage is not supported.");
    }
    var myDataString = localStorage.getItem("data");
    //var cookieString = document.cookie;
    //if ';' is found, split by ';'
    if (myDataString.indexOf(";") > -1) {
      myDataString = myDataString.split(';')[1];
    }
    var cookieVars = myDataString.split(',')
      , cookieVarsSize = cookieVars.length
      , j
      , cookieVarArr
      , varsObject = {}
    ;
    for (j = 0; j < cookieVarsSize; j++) {
      cookieVarArr = cookieVars[j].split("=");
      varsObject[cookieVarArr[0].trim()] = cookieVarArr[1];
    }
    if (myDataString && myDataString != '') {
      var data = varsObject["data"]
        , urlArr = data ? data.split("|") : []
        , urlArrSize = urlArr.length
        , i
      ;
      for (i = 0; i < urlArrSize; i++) {
        addUrlToList(urlArr[i], i);
      }
      langSource = varsObject["langSource"] ? varsObject["langSource"] : "ja";
      langTarget = varsObject["langTarget"] ? varsObject["langTarget"] : "en";
    }

    //set language dropdowns
    var langSourceSelect = document.getElementById("langSource")
      , langTargetSelect = document.getElementById("langTarget")
    ;
    langSourceSelect.value = langSource;
    langTargetSelect.value = langTarget;
    document.getElementById('url').focus();
  };

  function clearAllData() {
    urlList = [];
    var urlListElem = document.getElementById("urlList");
    urlListElem.innerHTML = "";
    localStorage.setItem("data", "data=,langSource=" + langSource + ",langTarget=" + langTarget);
  }

  window.addEventListener("unload", function() {
    persistData();
  });

  function persistData() {
    var urlListSize = urlList.length
      , dataStr = ''
      , i
    ;
    if (urlListSize > 0) {
      dataStr += urlList[0];
      for (i = 1; i < urlListSize; i++) {
        dataStr += "|" + urlList[i];
      }
    }
    localStorage.setItem("data", "data=" + dataStr + ",langSource=" + langSource + ",langTarget=" + langTarget);
  }

  function supportsHtml5Storage() {
    try {
      return 'localStorage' in window && window['localStorage'] !== null;
    }
    catch (e) {
      console.log("Local Storage is not supported in this browser. " + e);
    }
    return false;
  }
  </script>
</body>
</html>
