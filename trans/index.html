<html>
<head>
<title>trans</title>
<style>
body, li, div, span, input { font-size: 20px; font-family: arial; }
li { margin-bottom: 10px; }
</style>
</head>
<body>
  <table width="100%">
    <tr>
      <td>
        <input id="url" type="text" style="width:100%"
          onclick="this.select();"
          onkeypress="if(event.keyCode == 13){trans();this.value='';}" />
      </td>

      <td width="130">
        <input type="button" value="trans" onclick="trans();document.getElementById('url').value='';"/>
        <input type="button" value="clear" onclick="clearAllData();"/>
      </td>

      <td width="80">
        <select id="langSource" onchange="onLangChange();">
          <option value="ja">ja</option>
          <option value="en">en</option>
          <option value="lo">lo</option>
        </select>
        <select id="langTarget" onchange="onLangChange();">
          <option value="en">en</option>
          <option value="ja">ja</option>
          <option value="lo">lo</option>
        </select>
      </td>
    </tr>
  </table>

  <ul id="urlList"></ul>

  <script>
  var urlList = []
    , langSource = 'ja'
    , langTarget = 'en'
    , GTRANS_URL = 'https://translate.google.com/translate?hl=en&sl={langSource}&tl={langTarget}&anno=2&sandbox=1&u='
  ;
  function trans() {
    var urlInput = document.getElementById("url")
      , targetUrl = urlInput.value
    ;
    if (targetUrl == '') {
      return;
    }
    addUrlToList(targetUrl, urlList.length);
  }

  function addUrlToList(targetUrl, index) {
    addUrlToListInUi(targetUrl, index);

    urlList.push(targetUrl);
    //save urls
    persistUrlsToCookie();
  }

  function onLangChange() {
    var urlListElem = document.getElementById("urlList");
    urlListElem.innerHTML = "";

    var size = urlList.length, i;
    for (i = 0; i < size; i++) {
      addUrlToListInUi(urlList[i], i);
    }
    var langSourceSelect = document.getElementById("langSource")
      , langTargetSelect = document.getElementById("langTarget")
    ;
    langSource = langSourceSelect ? langSourceSelect.value : "ja"
    langTarget = langTargetSelect ? langTargetSelect.value : "en";
    persistUrlsToCookie();
  }

  function addUrlToListInUi(targetUrl, index) {
    var langSourceSelect = document.getElementById("langSource")
      , langTargetSelect = document.getElementById("langTarget")
    ;
    langSource = langSourceSelect ? langSourceSelect.value : "ja"
    langTarget = langTargetSelect ? langTargetSelect.value : "en";

    var transUrl = GTRANS_URL.replace(/\{langSource\}/g, langSource).replace(/\{langTarget\}/g, langTarget) + targetUrl.trim()
      , urlListElem = document.getElementById("urlList")
      , li = document.createElement("li")
      , link = '<a href="' + transUrl + '" target="_blank">' + targetUrl + '</a>'
          //+ ' ' + langSource + '&rArr;' + langTarget //&hArr;
          + ' (<a href="#" onclick="deleteLink(' + index + ', this);">x</a>)'
    ;

    if (urlListElem) {
      li.innerHTML = link;
      urlListElem.appendChild(li);
    }
    else {
      alert("URL list element not found!");
    }
    document.getElementById('url').focus();
  }

  function deleteLink(index, elem) {
    //console.log("deleteLink targetUrl=" + targetUrl + ", urlList.length=" + urlList.length);
    var parent = elem.parentNode;
    parent.parentNode.removeChild(parent);
    urlList.splice(index, 1);
    console.log("deleteLink removed link! urlList.length=" + urlList.length);
    persistUrlsToCookie();
    return false;
  }

  window.onload = function() {
    var cookieString = document.cookie;
    if (cookieString.indexOf(";") > -1) {
      cookieString = cookieString.split(';')[1];
    }
    var cookieVars = cookieString.split(',')
      , cookieVarsSize = cookieVars.length
      , j
      , cookieVarArr
      , varsObject = {}
    ;
    for (j = 0; j < cookieVarsSize; j++) {
      cookieVarArr = cookieVars[j].split("=");
      varsObject[cookieVarArr[0].trim()] = cookieVarArr[1];
    }
    if (cookieString && cookieString != '') {
      var data = varsObject["data"]
        , urlArr = data ? data.split("|") : []
        , urlArrSize = urlArr.length
        , i
      ;
      for (i = 0; i < urlArrSize; i++) {
        addUrlToList(urlArr[i], i);
      }
      langSource = varsObject["langSource"] ? varsObject["langSource"] : "ja";
      langTarget = varsObject["langTarget"] ? varsObject["langTarget"] : "en";
    }

    //set language dropdowns
    var langSourceSelect = document.getElementById("langSource")
      , langTargetSelect = document.getElementById("langTarget")
    ;
    langSourceSelect.value = langSource;
    langTargetSelect.value = langTarget;
    document.getElementById('url').focus();
  };

  function clearAllData() {
    urlList = [];
    var urlListElem = document.getElementById("urlList");
    urlListElem.innerHTML = "";
    document.cookie = "data=,langSource=" + langSource + ",langTarget=" + langTarget + "; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
  }

  window.addEventListener("unload", function() {
    persistUrlsToCookie();
  });

  function persistUrlsToCookie() {
    var urlListSize = urlList.length
      , dataStr = ''
      , i
    ;
    if (urlListSize > 0) {
      dataStr += urlList[0];
      for (i = 1; i < urlListSize; i++) {
        dataStr += "|" + urlList[i];
      }
    }
    document.cookie = "data=" + dataStr + ",langSource=" + langSource + ",langTarget=" + langTarget + "; path=/";
    console.log("persisted document.cookie=" + document.cookie);
  }
  </script>
</body>
</html>
