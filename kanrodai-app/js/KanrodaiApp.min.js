var map,kanrodaiApp,KANRODAI_LOC={lat:34.60119673714936,lng:135.84321758174895},DEFAULT_USER_LOC={lat:21.2869588443271,lng:-157.68656843825454};window.initMap=function(){map=new google.maps.Map(document.getElementById("map"),{zoom:15,center:KANRODAI_LOC,mapTypeControl:!0,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL},mapTypeId:google.maps.MapTypeId.SATELLITE});kanrodaiApp=new KanrodaiApp;kanrodaiApp.initialize()};
function KanrodaiApp(){this.kanrodaiPath=this.userInfowindow=this.userLocMarker=this.kanrodaiInfowindow=this.kanrodaiMarker=null}
KanrodaiApp.prototype.initialize=function(){var a=this;this.kanrodaiMarker=new google.maps.Marker({position:KANRODAI_LOC,icon:"images/kanrodai-30x30.png",title:"The Kanrodai!",map:map});this.kanrodaiInfowindow=new google.maps.InfoWindow({content:'<h2>The Kanrodai</h2>Learn more about the Kanrodai <a href="http://en.tenrikyo-resource.com/wiki/Kanrodai" target="_blank">here</a>.'});this.kanrodaiMarker.addListener("click",function(){a.kanrodaiInfowindow.open(map,a.kanrodaiMarker)});this.userLocMarker=
new google.maps.Marker({position:DEFAULT_USER_LOC,title:"You are here!",icon:"images/happi-coat-30x30.png",draggable:!0,map:map});google.maps.event.addListener(this.userLocMarker,"dragend",function(){var b={lat:this.getPosition().lat(),lng:this.getPosition().lng()};a.onLocationChanged(b)});this.userInfowindow=new google.maps.InfoWindow({content:"<h2>You're here!</h2>You may click-and-drag to move this icon to a more accurate location."});this.userLocMarker.addListener("click",function(){a.userInfowindow.open(map,
a.userLocMarker)});this.kanrodaiPath=new google.maps.Polyline({path:[KANRODAI_LOC,DEFAULT_USER_LOC],geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,map:map});this.getUserLocation()};
KanrodaiApp.prototype.onLocationChanged=function(a){this.kanrodaiPath.setPath([a,KANRODAI_LOC]);a=GreatCircle.getDistance(this.userLocMarker.getPosition(),new google.maps.LatLng(KANRODAI_LOC.lat,KANRODAI_LOC.lng));var b=document.getElementById("distance");b.style.textAlign="center";b.style.display="block";b.style.paddingTop="5px";b.innerHTML="<strong>Distance:</strong> "+this.formatDistance(a)};
KanrodaiApp.prototype.getUserLocation=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(this.showPosition):alert("Geolocation is not supported by this browser.")};KanrodaiApp.prototype.showPosition=function(a){a={lat:a.coords.latitude,lng:a.coords.longitude};map.setCenter(a);map.setZoom(9);kanrodaiApp.userLocMarker.setPosition(a);kanrodaiApp.onLocationChanged(a)};
KanrodaiApp.prototype.formatDistance=function(a){var b=" ft.",c,d=a;c=3.28084*a;5280<c&&(c/=5280,b=" mi.");c=Math.round(c);c=c.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");var e=" m";1E3<d&&(d=a/1E3,e=" km");d=Math.round(d);a=d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");return c+b+"("+a+e+")"};KanrodaiApp.prototype.goToKanrodai=function(){map.setCenter(KANRODAI_LOC);map.setZoom(19)};KanrodaiApp.prototype.goToUserLoc=function(){map.setCenter(this.userLocMarker.getPosition());map.setZoom(19)};
KanrodaiApp.prototype.viewPath=function(){var a;this.userLocMarker&&(a=GreatCircle.getMidPoint(this.userLocMarker.getPosition(),new google.maps.LatLng(KANRODAI_LOC.lat,KANRODAI_LOC.lng)),map.setCenter(a),a=GreatCircle.getDistance(this.userLocMarker.getPosition(),new google.maps.LatLng(KANRODAI_LOC.lat,KANRODAI_LOC.lng)),map.setZoom(GreatCircle.getZoomLevelByRange(a)));return!1};
